<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>유효성 검사 (회원가입 페이지)</title>

        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
            rel="stylesheet"
        />
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

        <link rel="stylesheet" href="css/main.css" />
        <script src="js/jquery-3.7.1.js"></script>
        <script>
            // 회원가입 버튼을 아래의 조건에 따라 유효성 검사를 하고
            // 유효하면 1-1_sub.html 페이지로 데이터를 전송하라
            // *: 필수항목

            // 아이디(*): 4 ~ 8 자 이하(소문자로 저장)
            // 비밀번호(*): 4자 이상 12자 이하
            // 이메일(*): 이메일 주소 형식
            // 휴대폰 번호(*): 전화번호 형식 검사
            // 성별(*): 남성 or 여성 반드시 하나 체크
            // 취미: 여러개 선택 가능
            // 직업(*): 반드시 하나를 선택
            // 메모: 가입인사 등 입력
            // 가입 조항 동의(*): 반드시 체크되어야 가입 가능

            // 가입하기, 유효성 검사
            function registerValid() {
                let valid = false;

                // 유효성 검사 통과 후 true
                // 아이디 검사
                let idCheck = validUserId($("#userId").val());
                let pwdCheck = validPwd($("#pwd1").val(), $("#pwd2").val());
                let emailCheck = validEmail($("#email").val());
                let mobileCheck = validMobile($("#mobile").val());
                let genderCheck = validGender();
                let hobby = getHobby();
                let job = getJob();
                let memo = getMemo();

                let isAgree = document.getElementById("agree").checked;
                if (!isAgree) {
                    outputError("가입 조항에 동의해주세요.", $("#agree-area"));
                }

                if (
                    idCheck &&
                    pwdCheck &&
                    emailCheck &&
                    mobileCheck &&
                    genderCheck &&
                    job &&
                    isAgree
                ) {
                    valid = true;
                }

                return valid;
                // return vaild;
            }

            function validUserId(userId) {
                let isCheck = false;

                if (userId === "") {
                    // 에러 메세지 출력
                    outputError("아이디는 필수항목입니다.", $("#userId"));
                } else if (userId.length <= 3 || userId.length > 8) {
                    outputError(
                        "아이디는 4자 이상 8자 이하로 입력해주세요.",
                        $("#userId")
                    );
                } else {
                    console.log("idChecked!");
                    isCheck = true;
                }

                return isCheck;
            }

            function validPwd(pwd1, pwd2) {
                let isCheck = false;
                if (pwd1 === "") {
                    outputError("비밀번호는 필수항목입니다.", $("#pwd1"));
                } else if (pwd1 != pwd2) {
                    outputError("비밀번호가 일치하지 않습니다.", $("#pwd1"));
                } else if (pwd1.length <= 3 || pwd1.length > 12) {
                    outputError(
                        "비밀번호는 4자 이상 12자 이하로 입력하세요.",
                        $("#pwd1")
                    );
                } else {
                    console.log("pwdChecked!");
                    isCheck = true;
                }
                return isCheck;
            }

            function validEmail(email) {
                let isCheck = false;

                let emailRegExp =
                    /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/i;

                if (!emailRegExp.test(email)) {
                    outputError("이메일 형식이 아닙니다.", $("#email"));
                } else {
                    isCheck = true;
                }

                return isCheck;
            }

            function validMobile(mobile) {
                let isCheck = false;

                let mobileRegExp = /^(01[016789]{1})-?[0-9]{3,4}-?[0-9]{4}$/;

                if (!mobileRegExp.test(mobile)) {
                    outputError("휴대폰 번호 형식이 아닙니다.", $("#mobile"));
                } else {
                    isCheck = true;
                }

                return isCheck;
            }

            function validGender(gender) {
                let isCheck = false;

                let radio1 = false;
                let radio2 = false;

                if (document.getElementsByName("gender")[0].checked) {
                    radio1 = true;
                }
                if (document.getElementsByName("gender")[1].checked) {
                    radio2 = true;
                }

                // 아무것도 선택되지 않았을 때
                if (radio1 == false && radio2 == false) {
                    outputError("성별 선택은 필수입니다.", $("#gender-field"));
                } else {
                    isCheck = true;
                }

                return isCheck;
            }

            function getHobby() {
                let hobbies = "";
                let hobbyArray = document.getElementsByName("hobby");

                for (hobby of hobbyArray) {
                    if (hobby.checked) {
                        // console.log(hobby.value);
                        hobbies += `${hobby.value},`;
                    }
                }

                // 가장 마지막 콤마 제거
                console.log(hobbies.slice(0, -1));
                // 콤마제거 2
                // hobbies.substring(0, hobbies.length -1);
                return hobbies.slice(0, -1);
            }

            function getJob() {
                let isCheck = false;

                let value = document.getElementById("job").value;
                // document.getElementById("job").selectedIndex; 로도 사용 가능

                if (value == "--직업 선택--") {
                    outputError("직업을 선택해 주세요.", $("#job"));
                } else {
                    isCheck = true;
                }

                return isCheck;
            }

            function getMemo() {
                let memo = document.getElementById("memo").value;

                return memo;
            }

            function outputError(errMsg, tagObj) {
                // errorMsg에 tagObj 객체 다음 요소에 삽입시켜 출력
                let err = `<div class="errMsg">
                ${errMsg}
                    </div>`;

                $(err).insertAfter($(tagObj));
                $(".errMsg").hide(4000);
            }
        </script>
    </head>
    <body>
        <form action="1-1_sub.html">
            <div class="container">
                <h1>회원가입</h1>
                <p>아래 항목을 기입해 주세요. (*: 필수항목)</p>
                <hr />
                <label for="userId"><b>아이디(*): </b></label>
                <input
                    id="userId"
                    type="text"
                    placeholder="아이디 입력"
                    name="userId"
                />

                <label for="pwd1"><b>비밀번호(*): </b></label>
                <input
                    id="pwd1"
                    type="password"
                    placeholder="비밀번호 입력"
                    name="pwd1"
                />

                <label for="pwd2"><b>비밀번호 확인(*): </b></label>
                <input
                    id="pwd2"
                    type="password"
                    placeholder="비밀번호 확인"
                    name="pwd2"
                />

                <label for="email"><b>E-mail(*): </b></label>
                <input
                    id="email"
                    type="text"
                    placeholder="이메일 입력"
                    name="email"
                />

                <label for="mobile"><b>휴대폰 번호(*): </b></label>
                <input
                    id="mobile"
                    type="text"
                    placeholder="휴대폰 번호 입력"
                    name="mobile"
                />

                <fieldset id="gender-field">
                    <legend>성별(*)</legend>
                    <div class="form-check">
                        <input
                            type="radio"
                            class="form-check-input"
                            id="male"
                            name="gender"
                            value="male"
                        />
                        <label class="form-check-label" for="male">남성</label>
                    </div>
                    <div class="form-check">
                        <input
                            type="radio"
                            class="form-check-input"
                            id="female"
                            name="gender"
                            value="female"
                        />
                        <label class="form-check-label" for="female"
                            >여성</label
                        >
                    </div>
                </fieldset>

                <fieldset>
                    <legend>취미</legend>
                    <div class="form-check">
                        <input
                            type="checkbox"
                            class="form-check-input"
                            id="hobby1"
                            name="hobby"
                            value="study"
                        />
                        <label class="form-check-label" for="hobby1"
                            >공부</label
                        >
                    </div>
                    <div class="form-check">
                        <input
                            type="checkbox"
                            class="form-check-input"
                            id="hobby2"
                            name="hobby"
                            value="music"
                        />
                        <label class="form-check-label" for="hobby2"
                            >음악감상</label
                        >
                    </div>
                    <div class="form-check">
                        <input
                            type="checkbox"
                            class="form-check-input"
                            id="hobby3"
                            name="hobby"
                            value="game"
                        />
                        <label class="form-check-label" for="hobby3"
                            >게임</label
                        >
                    </div>
                </fieldset>

                <label for="job" class="form-label">직업(select one):</label>
                <select class="form-select" id="job" name="job">
                    <option>--직업 선택--</option>
                    <option value="student">학생</option>
                    <option value="creator">크리에이터</option>
                    <option value="buildingOwner">건물주</option>
                    <option value="official">공무원</option>
                </select>

                <div class="mb-3 mt-3">
                    <label for="memo">메모</label>
                    <textarea
                        class="form-control"
                        rows="5"
                        id="memo"
                        name="memo"
                    ></textarea>
                </div>

                <div id="agree-area" class="form-check">
                    <input
                        type="checkbox"
                        class="form-check-input"
                        id="agree"
                        name="agree"
                        value="Y"
                    />

                    <label class="form-check-label" for="agree"
                        >가입 조항에 동의합니다.</label
                    >
                </div>

                <p>
                    <a href="#">가입조항</a>
                </p>

                <div class="clearfix">
                    <button
                        class="signUpBtn"
                        type=""
                        onclick="return registerValid()"
                    >
                        가입하기
                    </button>
                    <button class="cancelBtn" type="reset">취소</button>
                </div>
            </div>
        </form>
    </body>
</html>
